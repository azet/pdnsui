<!-- <?r #if logged_in? ?> -->
<!-- <?r #end ?> -->

<h1>#{@domain.name}</h1>

<!-- this is the new record form
For best effect, it should adapt according to the record type
For instance, LOC records should bring a map
CNAME records should bring a list or A, AAAA, PTR, ... (should read RFC 1031/2181) -->

<form class="well" method='POST' action="#{Records.r(:save)}">

  <div class="control-group">

    <!-- Record Name -->
    <label class="control-label" for="name">Entry name</label>
    <div class="controls">
      <div class="input-append">
        <input class="span2" name="name" id="name" size="16" type="text" placeholder="whatever">
        <span class="add-on">#{@domain.name}</span>
      </div>
      <!-- 
      #FIXME: This doesn"t work for some reason, it should be next to the field
      -->
      <span class="help-inline">Type you record full name (without trailing dot)</span>
    </div>

    <!-- Record Type -->
    <select class="span2" name="type">
      <option>A</option>
      <option>CNAME</option>
      <option>AAAA</option>
      <option>PTR</option>
      <option>NS</option>
      <option>TXT</option>
    </select>

    <!-- Record Content -->
    <label class="control-label" for="content">Content</label>
    <div class="controls">
      <div class="input-append">
        <input class="span2" name="content" id="content" size="16" type="text" placeholder="whatever">
        <span class="add-on">#{@domain.name}</span>
      </div>
      <!-- 
      #FIXME: This doesn't work for some reason, it should be next to the field
      -->
      <span class="help-inline">Type you record full name (without trailing dot)</span>
    </div>

    <input type="hidden" name="domain_id" value="#{@domain.id}">

  </div>

  <button type="submit" class="btn">Add record</button>

</form>

<?r if ! @records.empty? ?>

<div class="row">
  <div class="span12">

    <table class="table table-striped table-condensed">
      <thead>
        <tr>
          <?r 
          od = request.params['order'] == 'desc' ? 'asc' : 'desc'
          [ 'Name', 'Type', 'Content', 'TTL' ].each do |h|
            cls =  "btn btn-mini"
            chevron = ""
            sb = h.downcase
            if h.downcase == request.params['sortby']
              cls += " btn-info" 
              if request.params['order'] == 'desc' 
                chevron = "<i class=\"icon-chevron-up\"></i>"
              else
                chevron = "<i class=\"icon-chevron-down\"></i>"
              end 
            end ?>

            <th><a class=\"#{cls}\" href="#{Domains.r(:records, @domain.id, { :sortby => sb, :order => od })}">#{chevron}#{h}</a></th>

          <?r end ?>
          <th></th>
        </tr>
      </thead>
      <tbody>

        <?r @records.each do |record| ?>
        <tr>
          <td>#{record.name}</td>
          <td>#{record.type}</td>
          <td>#{record.content}</td>
          <td>#{record.ttl}</td>
          <td>
            <div class="btn-group">
              <a class="btn btn-mini" href="#"><i class="icon-edit"></i></a>
              <a class="btn btn-mini" href="#"><i class="icon-remove"></i></a>
            </div>
          </td>
        </tr>
        <?r end ?>

      </tbody>
    </table>

  </div>
</div>

<div class="row">
  <div class="span12">

#{@records.navigation}

  </div>
</div>

<?r else ?>

<div class="row">
  <div class="alert">
    <a class="close" data-dismiss="alert">Ã—</a>
    No records found
  </div>
</div>

<?r end ?>



